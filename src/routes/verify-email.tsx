import { useEffect, useState } from 'react';
import { createFileRoute, Link } from '@tanstack/react-router';
import Button from '../component/ui/Button';
import { z } from 'zod';
import authHttp from '../http/authHttp';
import { useAuth } from '../context/AuthContext';

const resetSchema = z.object({
  token: z.string().optional(),
});

export const Route = createFileRoute('/verify-email')({
  validateSearch: resetSchema,
  component: VerifyEmailRoute,
});

function VerifyEmailRoute() {
  const { token } = Route.useSearch();
  const [status, setStatus] = useState<'idle' | 'loading' | 'success' | 'error'>('idle');
  const [errorMessage, setErrorMessage] = useState('');
  const { getUser } = useAuth();
  const { authAxios } = Route.useRouteContext();

  useEffect(() => {
    if (!token) {
      setStatus('error');
      setErrorMessage('Oops! You are not currently authorized to verify email.');
      return;
    }

    setStatus('loading');
    const verify = async () => {
      await authHttp
        .verifyEmail({ token })
        .then(async () => {
          setStatus('success');
          await getUser({ authAxios });
        })
        .catch((err: any) => {
          setStatus('error');
          setErrorMessage(err.message.toString());
        });
    };
    verify();
  }, [token]);

  return (
    <div className="max-w-[440px] mx-auto px-4 mt-[20%] sm:mt-[10%] h-dvh text-center   justify-center items-center">
      {status === 'loading' && (
        <>
          <div className=" w-fit mx-auto">
            <svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M6.90192 100H50.1816C64.8677 99.9486 79.5537 99.9486 94.2398 100C96.8864 100 98.4432 98.9209 99.3773 96.557C99.8443 95.3751 99.8443 94.1932 99.8443 93.0113C99.8616 87.1455 99.8732 81.2741 99.8847 75.3988V75.3948C99.9078 63.6683 99.9308 51.9267 100 40.185C100 38.7975 99.481 37.8212 98.3913 36.9476C83.9134 25.4372 69.4874 13.8755 55.0614 2.31379L55.0597 2.31244C51.2195 -0.770812 48.7805 -0.770812 44.9403 2.31244C39.3601 6.76096 33.7877 11.225 28.211 15.6924L28.2099 15.6933C19.4213 22.7338 10.622 29.7828 1.7644 36.7934C0.518941 37.8212 0 38.9003 0 40.4933C0.0259471 49.2806 0.0259471 58.0807 0.0259471 66.8872C0.0259471 75.6937 0.0259471 84.5067 0.0518942 93.3196C0.103788 97.9959 2.17955 100 6.90192 100ZM5.44888 40.0823L5.45259 40.0793C16.8679 30.9335 28.2838 21.7872 39.699 12.6928C40.464 12.084 41.229 11.4789 41.9931 10.8744C44.1314 9.18289 46.2626 7.49692 48.3653 5.75546C49.4551 4.88187 50.3373 4.67632 51.5309 5.6013C61.2709 13.4291 71.0349 21.2568 80.8392 29.1169L80.8467 29.1229C85.4573 32.8191 90.0767 36.5225 94.7068 40.2364C92.3149 42.1484 89.9309 44.0525 87.5527 45.952L87.5063 45.9891C81.3353 50.9178 75.2032 55.8156 69.0711 60.74C68.1098 61.5053 67.1468 62.2706 66.183 63.0365L66.1756 63.0423C61.8351 66.4916 57.4784 69.9536 53.1915 73.4841C51.479 74.8716 49.9741 75.0771 48.1059 73.6383C41.1016 68.141 34.0973 62.6693 27.0931 57.1977L27.0887 57.1943L27.0872 57.1931L27.0823 57.1893C20.0787 51.7182 13.0752 46.2471 6.07161 40.7503C5.91564 40.6576 5.81592 40.5278 5.70482 40.3832C5.6311 40.2873 5.55238 40.1848 5.44888 40.0823ZM92.4239 95.478H9.23756C9.35673 94.7306 9.87118 94.4048 10.3387 94.1087C10.4819 94.0179 10.6208 93.93 10.7425 93.8336C13.1952 91.8667 15.6523 89.9042 18.1086 87.9422L18.1118 87.9397L18.1136 87.9383C24.127 83.1352 30.1361 78.3356 36.0668 73.4841C37.6755 72.1994 38.7134 72.1994 40.1665 73.5355C41.6712 74.9352 43.2961 76.1366 44.9355 77.3487C45.162 77.5161 45.3886 77.6837 45.6153 77.8521C48.7809 80.2159 52.2578 80.1645 55.4233 77.8007C57.4991 76.2591 59.523 74.666 61.4431 72.9703C62.5328 71.9939 63.2594 72.1994 64.2972 73.0216C72.7464 79.7432 81.1521 86.4647 89.9513 93.5008L92.4239 95.478ZM7.55472 48.0733L5.08603 46.1461V92.0865C11.2156 87.1729 17.2439 82.3596 23.2722 77.5463L23.3533 77.4816C26.9438 74.6147 30.5345 71.7477 34.1467 68.8594C25.2585 61.8935 16.5008 55.0569 7.55472 48.0733ZM95.0185 91.2643C87.3313 85.166 79.828 79.1769 72.3847 73.2357L72.2946 73.1638C70.9244 72.0701 69.5562 70.978 68.1892 69.8872C68.1139 69.8286 68.0364 69.7711 67.9593 69.714C67.293 69.2199 66.6631 68.7529 67.826 67.8317L68.0763 67.6325C76.9705 60.556 85.8672 53.4776 95.0185 46.1975V91.2643Z"
                fill="#307EE1"
              />
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M70.7553 39.4522C70.7034 28.0956 61.4662 19 49.9976 19C38.529 19 29.2919 28.0442 29.24 39.4008C29.24 50.7575 38.4253 60.0072 49.842 60.11C61.3106 60.2127 70.8072 50.8602 70.7553 39.4522ZM34.0659 39.2469C33.8583 47.88 41.0197 55.0742 49.8417 55.177C58.6637 55.2798 65.877 48.2911 65.9289 39.5552C66.0327 31.0249 58.8713 23.8307 50.3088 23.7279C41.4349 23.6251 34.2735 30.511 34.0659 39.2469Z"
                fill="#307EE1"
              />
              <path
                d="M49.6838 42.9915C49.046 42.9887 48.465 42.7797 47.8829 42.3642C47.5616 41.924 47.3269 41.4067 47.2943 40.7613C47.2999 39.1481 47.2838 37.5413 47.2677 35.9345C47.2516 34.3277 47.2355 32.7209 47.2411 31.1078C47.234 29.8172 47.9541 28.9686 49.4328 29.0009C50.8823 29.0072 51.6117 29.8622 51.6477 31.1271C51.6854 32.7017 51.6939 34.2504 51.7027 35.8507L51.7039 35.9296C51.7475 38.768 51.748 38.7957 54.9093 39.0653C56.3306 39.2005 57.2328 39.8497 57.24 41.1403C57.2468 42.3793 56.3513 42.969 54.9889 42.9889C53.2208 43.007 51.481 42.9994 49.6838 42.9915Z"
                fill="#307EE1"
              />
            </svg>
          </div>
          <p className="mt-6 text-themeGray">Verifying your email, please wait...</p>
        </>
      )}

      {status === 'error' && (
        <>
          <div className=" w-fit mx-auto">
            <svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M6.90192 100H50.1816C64.8677 99.9486 79.5537 99.9486 94.2398 100C96.8864 100 98.4432 98.9209 99.3773 96.557C99.8443 95.3751 99.8443 94.1932 99.8443 93.0113C99.8616 87.1455 99.8732 81.2741 99.8847 75.3988V75.3948C99.9078 63.6683 99.9308 51.9267 100 40.185C100 38.7975 99.481 37.8212 98.3913 36.9476C83.9134 25.4372 69.4874 13.8755 55.0614 2.31379L55.0597 2.31244C51.2195 -0.770812 48.7805 -0.770812 44.9403 2.31244C39.3601 6.76096 33.7877 11.225 28.211 15.6924L28.2099 15.6933C19.4213 22.7338 10.622 29.7828 1.7644 36.7934C0.518941 37.8212 0 38.9003 0 40.4933C0.0259471 49.2806 0.0259471 58.0807 0.0259471 66.8872C0.0259471 75.6937 0.0259471 84.5067 0.0518942 93.3196C0.103788 97.9959 2.17955 100 6.90192 100ZM5.44888 40.0823L5.45259 40.0793C16.8679 30.9335 28.2838 21.7872 39.699 12.6928C40.464 12.084 41.229 11.4789 41.9931 10.8744C44.1314 9.18289 46.2626 7.49692 48.3653 5.75546C49.4551 4.88187 50.3373 4.67632 51.5309 5.6013C61.2709 13.4291 71.0349 21.2568 80.8392 29.1169L80.8467 29.1229C85.4573 32.8191 90.0767 36.5225 94.7068 40.2364C92.3149 42.1484 89.9309 44.0525 87.5527 45.952L87.5063 45.9891C81.3353 50.9178 75.2032 55.8156 69.0711 60.74C68.1098 61.5053 67.1468 62.2706 66.183 63.0365L66.1756 63.0423C61.8351 66.4916 57.4784 69.9536 53.1915 73.4841C51.479 74.8716 49.9741 75.0771 48.1059 73.6383C41.1016 68.141 34.0973 62.6693 27.0931 57.1977L27.0887 57.1943L27.0872 57.1931L27.0823 57.1893C20.0787 51.7182 13.0752 46.2471 6.07161 40.7503C5.91564 40.6576 5.81592 40.5278 5.70482 40.3832C5.6311 40.2873 5.55238 40.1848 5.44888 40.0823ZM92.4239 95.478H9.23756C9.35673 94.7306 9.87118 94.4048 10.3387 94.1087C10.4819 94.0179 10.6208 93.93 10.7425 93.8336C13.1952 91.8667 15.6523 89.9042 18.1086 87.9422L18.1118 87.9397L18.1136 87.9383C24.127 83.1352 30.1361 78.3356 36.0668 73.4841C37.6755 72.1994 38.7134 72.1994 40.1665 73.5355C41.6712 74.9352 43.2961 76.1366 44.9355 77.3487C45.162 77.5161 45.3886 77.6837 45.6153 77.8521C48.7809 80.2159 52.2578 80.1645 55.4233 77.8007C57.4991 76.2591 59.523 74.666 61.4431 72.9703C62.5328 71.9939 63.2594 72.1994 64.2972 73.0216C72.7464 79.7432 81.1521 86.4647 89.9513 93.5008L92.4239 95.478ZM7.55472 48.0733L5.08603 46.1461V92.0865C11.2156 87.1729 17.2439 82.3596 23.2722 77.5463L23.3533 77.4816C26.9438 74.6147 30.5345 71.7477 34.1467 68.8594C25.2585 61.8935 16.5008 55.0569 7.55472 48.0733ZM95.0185 91.2643C87.3313 85.166 79.828 79.1769 72.3847 73.2357L72.2946 73.1638C70.9244 72.0701 69.5562 70.978 68.1892 69.8872C68.1139 69.8286 68.0364 69.7711 67.9593 69.714C67.293 69.2199 66.6631 68.7529 67.826 67.8317L68.0763 67.6325C76.9705 60.556 85.8672 53.4776 95.0185 46.1975V91.2643Z"
                fill="#307EE1"
              />
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M70.7553 39.4522C70.7034 28.0956 61.4662 19 49.9976 19C38.529 19 29.2919 28.0442 29.24 39.4008C29.24 50.7575 38.4253 60.0072 49.842 60.11C61.3106 60.2127 70.8072 50.8602 70.7553 39.4522ZM34.0659 39.2469C33.8583 47.88 41.0197 55.0742 49.8417 55.177C58.6637 55.2798 65.877 48.2911 65.9289 39.5552C66.0327 31.0249 58.8713 23.8307 50.3088 23.7279C41.4349 23.6251 34.2735 30.511 34.0659 39.2469Z"
                fill="#307EE1"
              />
              <path
                d="M49.6838 42.9915C49.046 42.9887 48.465 42.7797 47.8829 42.3642C47.5616 41.924 47.3269 41.4067 47.2943 40.7613C47.2999 39.1481 47.2838 37.5413 47.2677 35.9345C47.2516 34.3277 47.2355 32.7209 47.2411 31.1078C47.234 29.8172 47.9541 28.9686 49.4328 29.0009C50.8823 29.0072 51.6117 29.8622 51.6477 31.1271C51.6854 32.7017 51.6939 34.2504 51.7027 35.8507L51.7039 35.9296C51.7475 38.768 51.748 38.7957 54.9093 39.0653C56.3306 39.2005 57.2328 39.8497 57.24 41.1403C57.2468 42.3793 56.3513 42.969 54.9889 42.9889C53.2208 43.007 51.481 42.9994 49.6838 42.9915Z"
                fill="#307EE1"
              />
            </svg>
          </div>
          <h1 className="mt-6 text-lg text-red-500 font-semibold">Verification Failed</h1>
          <p className="mt-2 text-themeGray">{errorMessage}</p>
        </>
      )}

      {status === 'success' && (
        <>
          <div className=" w-fit mx-auto text-center">
            <svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M6.90192 100H50.1816C64.8677 99.9486 79.5537 99.9486 94.2398 100C96.8864 100 98.4432 98.9209 99.3773 96.557C99.8443 95.3751 99.8443 94.1932 99.8443 93.0113C99.8616 87.1455 99.8732 81.2741 99.8847 75.3988V75.3948C99.9078 63.6683 99.9308 51.9267 100 40.185C100 38.7975 99.481 37.8212 98.3913 36.9476C83.9134 25.4372 69.4874 13.8755 55.0614 2.31379L55.0597 2.31244C51.2195 -0.770812 48.7805 -0.770812 44.9403 2.31244C39.3601 6.76096 33.7877 11.225 28.211 15.6924L28.2099 15.6933C19.4213 22.7338 10.622 29.7828 1.7644 36.7934C0.518941 37.8212 0 38.9003 0 40.4933C0.0259471 49.2806 0.0259471 58.0807 0.0259471 66.8872C0.0259471 75.6937 0.0259471 84.5067 0.0518942 93.3196C0.103788 97.9959 2.17955 100 6.90192 100ZM5.44888 40.0823L5.45259 40.0793C16.8679 30.9335 28.2838 21.7872 39.699 12.6928C40.464 12.084 41.229 11.4789 41.9931 10.8744C44.1314 9.18289 46.2626 7.49692 48.3653 5.75546C49.4551 4.88187 50.3373 4.67632 51.5309 5.6013C61.2709 13.4291 71.0349 21.2568 80.8392 29.1169L80.8467 29.1229C85.4573 32.8191 90.0767 36.5225 94.7068 40.2364C92.3149 42.1484 89.9309 44.0525 87.5527 45.952L87.5063 45.9891C81.3353 50.9178 75.2032 55.8156 69.0711 60.74C68.1098 61.5053 67.1468 62.2706 66.183 63.0365L66.1756 63.0423C61.8351 66.4916 57.4784 69.9536 53.1915 73.4841C51.479 74.8716 49.9741 75.0771 48.1059 73.6383C41.1016 68.141 34.0973 62.6693 27.0931 57.1977L27.0887 57.1943L27.0872 57.1931L27.0823 57.1893C20.0787 51.7182 13.0752 46.2471 6.07161 40.7503C5.91564 40.6576 5.81592 40.5278 5.70482 40.3832C5.6311 40.2873 5.55238 40.1848 5.44888 40.0823ZM92.4239 95.478H9.23756C9.35673 94.7306 9.87118 94.4048 10.3387 94.1087C10.4819 94.0179 10.6208 93.93 10.7425 93.8336C13.1952 91.8667 15.6523 89.9042 18.1086 87.9422L18.1118 87.9397L18.1136 87.9383C24.127 83.1352 30.1361 78.3356 36.0668 73.4841C37.6755 72.1994 38.7134 72.1994 40.1665 73.5355C41.6712 74.9352 43.2961 76.1366 44.9355 77.3487C45.162 77.5161 45.3886 77.6837 45.6153 77.8521C48.7809 80.2159 52.2578 80.1645 55.4233 77.8007C57.4991 76.2591 59.523 74.666 61.4431 72.9703C62.5328 71.9939 63.2594 72.1994 64.2972 73.0216C72.7464 79.7432 81.1521 86.4647 89.9513 93.5008L92.4239 95.478ZM7.55472 48.0733L5.08603 46.1461V92.0865C11.2156 87.1729 17.2439 82.3596 23.2722 77.5463L23.3533 77.4816C26.9438 74.6147 30.5345 71.7477 34.1467 68.8594C25.2585 61.8935 16.5008 55.0569 7.55472 48.0733ZM95.0185 91.2643C87.3313 85.166 79.828 79.1769 72.3847 73.2357L72.2946 73.1638C70.9244 72.0701 69.5562 70.978 68.1892 69.8872C68.1139 69.8286 68.0364 69.7711 67.9593 69.714C67.293 69.2199 66.6631 68.7529 67.826 67.8317L68.0763 67.6325C76.9705 60.556 85.8672 53.4776 95.0185 46.1975V91.2643Z"
                fill="#307EE1"
              />
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M70.7553 39.4522C70.7034 28.0956 61.4662 19 49.9976 19C38.529 19 29.2919 28.0442 29.24 39.4008C29.24 50.7575 38.4253 60.0072 49.842 60.11C61.3106 60.2127 70.8072 50.8602 70.7553 39.4522ZM34.0659 39.2469C33.8583 47.88 41.0197 55.0742 49.8417 55.177C58.6637 55.2798 65.877 48.2911 65.9289 39.5552C66.0327 31.0249 58.8713 23.8307 50.3088 23.7279C41.4349 23.6251 34.2735 30.511 34.0659 39.2469Z"
                fill="#307EE1"
              />
              <path
                d="M49.6838 42.9915C49.046 42.9887 48.465 42.7797 47.8829 42.3642C47.5616 41.924 47.3269 41.4067 47.2943 40.7613C47.2999 39.1481 47.2838 37.5413 47.2677 35.9345C47.2516 34.3277 47.2355 32.7209 47.2411 31.1078C47.234 29.8172 47.9541 28.9686 49.4328 29.0009C50.8823 29.0072 51.6117 29.8622 51.6477 31.1271C51.6854 32.7017 51.6939 34.2504 51.7027 35.8507L51.7039 35.9296C51.7475 38.768 51.748 38.7957 54.9093 39.0653C56.3306 39.2005 57.2328 39.8497 57.24 41.1403C57.2468 42.3793 56.3513 42.969 54.9889 42.9889C53.2208 43.007 51.481 42.9994 49.6838 42.9915Z"
                fill="#307EE1"
              />
            </svg>
          </div>
          <div className=" w-fit mx-auto">
            <h1 className="mt-6 text-lg text-green-600 font-semibold">Email Verified Successfully!</h1>
            <p className="mt-2 text-themeGray">You can now use your account.</p>
            <p className=" text-start mt-8 text-themeGray text-sm ">
              Back to{' '}
              <Link to="/" className=" text-themeBlue font-medium">
                Home
              </Link>
            </p>
          </div>
        </>
      )}
    </div>
  );
}
